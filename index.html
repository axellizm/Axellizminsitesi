<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AXELLIZM v2.0</title>

    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            --neon: #ccff00;
            --bg: #000;
            --border: rgba(204, 255, 0, 0.2);
            --glass: rgba(255, 255, 255, 0.02);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg);
            color: #fff; 
            overflow: hidden; 
            height: 100vh; width: 100%; 
            animation: bgShift 15s infinite alternate ease-in-out;
        }

        @keyframes bgShift {
            0% { background: radial-gradient(circle at 10% 10%, #1a1a00 0%, #000 80%); }
            100% { background: radial-gradient(circle at 90% 90%, #2a2a00 0%, #000 80%); }
        }

        .glass-card { 
            background: var(--glass); 
            border: 1px solid var(--border); 
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 35px; 
            padding: 25px; 
            backdrop-filter: blur(45px); 
            -webkit-backdrop-filter: blur(45px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.7);
            margin-bottom: 20px;
        }

        .scene { position: fixed; inset: 0; padding: 40px 20px 420px; opacity: 0; transform: translateY(30px); transition: 0.7s cubic-bezier(0.19, 1, 0.22, 1); overflow-y: auto; pointer-events: none; visibility: hidden; }
        .scene.active { opacity: 1; transform: translateY(0); pointer-events: auto; visibility: visible; }

        /* MÃ¼zik Player */
        .player-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        .art-box {
            position: relative;
            width: 65px; height: 65px;
        }
        .album-art {
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 2px solid var(--neon);
            object-fit: cover;
            transition: 0.5s;
        }
        .is-playing .album-art { animation: rotateArt 12s linear infinite; box-shadow: 0 0 20px var(--neon); }
        @keyframes rotateArt { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .play-btn {
            background: var(--neon);
            color: #000;
            border: none;
            width: 40px; height: 40px;
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }

        .nav-dock { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); border: 1px solid var(--border); padding: 12px; border-radius: 45px; display: flex; gap: 12px; z-index: 1000; backdrop-filter: blur(25px); }
        .nav-item { font-size: 1.4rem; color: #444; cursor: pointer; transition: 0.4s; width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .nav-item.active { color: var(--neon); background: rgba(204, 255, 0, 0.1); }

        #toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%) translateY(-250%); background: var(--neon); color: #000; padding: 15px 30px; border-radius: 50px; z-index: 10000; transition: 0.6s cubic-bezier(0.23, 1, 0.32, 1); font-weight: 900; letter-spacing: 1px; }
        #toast.active { transform: translateX(-50%) translateY(0); }

        canvas { border-radius: 30px; border: 1px solid var(--border); width: 100%; aspect-ratio: 1; background: #000; }
        input { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; padding: 18px; border-radius: 20px; width: 100%; margin-bottom: 12px; outline: none; }
    </style>
</head>
<body>

    <div id="toast">SYSTEM INITIALIZED</div>

    <div id="auth-overlay" style="position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center; background: #000;">
        <div class="glass-card" style="width:85%; max-width:400px; text-align:center;">
            <h1 style="font-family:'Syne'; font-size: 2.8rem; color:var(--neon); margin-bottom:5px; letter-spacing:-2px;">AXELLIZM</h1>
            <p style="font-size: 0.6rem; opacity:0.4; letter-spacing:4px; margin-bottom:30px;">NEURAL INTERFACE 2.0</p>
            <input type="email" id="auth-email" placeholder="NEURAL IDENTITY">
            <input type="password" id="auth-pass" placeholder="SECURITY KEY">
            <button onclick="AuthSvc.handleAuth()" style="background:var(--neon); border:none; width:100%; padding:20px; border-radius:20px; font-weight:900; letter-spacing:2px; cursor:pointer;">ACCESS SYSTEM</button>
        </div>
    </div>

    <div id="app-container">
        <section class="scene active" id="scene-home">
            <div class="glass-card" id="media-card">
                <div class="player-bar">
                    <div class="art-box">
                        <img src="https://files.catbox.moe/57j9kg.jpg" class="album-art" id="art-ui">
                    </div>
                    <div style="flex:1">
                        <p style="font-size:0.9rem; font-weight:800; color:var(--neon); margin-bottom:2px;">Axellizm Atmospheric</p>
                        <p style="font-size:0.6rem; opacity:0.5; text-transform:uppercase; letter-spacing:1px;">Neural Stream Active</p>
                    </div>
                    <button class="play-btn" onclick="AudioSvc.toggle()"><i class="fa-solid fa-play" id="play-icon"></i></button>
                </div>
            </div>

            <div id="home-heart" style="height:280px; margin: 20px 0;"></div>

            <div class="glass-card" style="text-align:center; padding:15px;" onclick="Router.go('game')">
                <p style="font-weight:900; letter-spacing:2px; color:var(--neon); font-size:0.8rem;">LAUNCH NEURAL GRID</p>
            </div>
        </section>

        <section class="scene" id="scene-game">
            <div class="glass-card" style="display:flex; justify-content:space-between; align-items:center; padding: 15px 30px;">
                <div><small style="opacity:0.5; font-size:0.6rem;">SCORE</small><h2 id="score" style="color:var(--neon)">0</h2></div>
                <div style="text-align:right;"><small style="opacity:0.5; font-size:0.6rem;">MAX_REKOR</small><h2 id="best-score" style="opacity:0.8">0</h2></div>
            </div>
            <canvas id="snake-canvas"></canvas>
            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:15px; margin-top:30px; justify-items:center;">
                <div class="nav-item" style="grid-column:2; background:rgba(255,255,255,0.05)" onclick="SnakeGame.setDir('UP')"><i class="fa-solid fa-angle-up"></i></div>
                <div class="nav-item" style="grid-column:1; background:rgba(255,255,255,0.05)" onclick="SnakeGame.setDir('LEFT')"><i class="fa-solid fa-angle-left"></i></div>
                <div class="nav-item" style="grid-column:3; background:rgba(255,255,255,0.05)" onclick="SnakeGame.setDir('RIGHT')"><i class="fa-solid fa-angle-right"></i></div>
                <div class="nav-item" style="grid-column:2; background:rgba(255,255,255,0.05)" onclick="SnakeGame.setDir('DOWN')"><i class="fa-solid fa-angle-down"></i></div>
            </div>
        </section>

        <section class="scene" id="scene-profile">
            <div class="glass-card" style="text-align:center;">
                <img src="" id="p-avatar" style="width:120px; height:120px; border-radius:50%; border:3px solid var(--neon); margin-bottom:20px; object-fit:cover;">
                <input type="text" id="p-nick-i" placeholder="NEURAL_NICKNAME">
                <button class="btn-glass" style="width:100%; background:rgba(204,255,0,0.1); color:var(--neon); border:1px solid var(--border); padding:15px; border-radius:15px; font-weight:800;" onclick="ProfileSvc.save()">SYNC DATA</button>
                <button onclick="AuthSvc.logout()" style="margin-top:20px; background:none; border:none; color:#555; font-size:0.7rem; font-weight:800; cursor:pointer; letter-spacing:2px;">TERMINATE SESSION</button>
            </div>
        </section>
    </div>

    <nav class="nav-dock">
        <div class="nav-item active" data-target="home" onclick="Router.go('home')"><i class="fa-solid fa-house-chimney-window"></i></div>
        <div class="nav-item" data-target="game" onclick="Router.go('game')"><i class="fa-solid fa-gamepad"></i></div>
        <div class="nav-item" data-target="profile" onclick="Router.go('profile')"><i class="fa-solid fa-user-gear"></i></div>
    </nav>

    <audio id="main-audio" loop>
        <source src="https://files.catbox.moe/0u3f2b.mp3" type="audio/mpeg">
    </audio>

    <script>
        const SB_URL = "https://oxbmgiiyyxuwwitudtru.supabase.co";
        const SB_KEY = "sb_publishable_qYUzpHdAnO-C4xYwUF3wdg_v_zZzYif";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);
        let currentUser = null;

        const AudioSvc = {
            el: document.getElementById('main-audio'),
            btn: document.getElementById('play-icon'),
            ui: document.getElementById('media-card'),
            toggle() {
                if(this.el.paused) {
                    this.el.play();
                    this.btn.className = 'fa-solid fa-pause';
                    this.ui.classList.add('is-playing');
                } else {
                    this.el.pause();
                    this.btn.className = 'fa-solid fa-play';
                    this.ui.classList.remove('is-playing');
                }
            }
        };

        const AuthSvc = {
            async handleAuth() {
                const e = document.getElementById('auth-email').value;
                const p = document.getElementById('auth-pass').value;
                if(!e || p.length < 6) return Utils.toast("INVALID SECURITY KEY");

                const { data, error } = await _supabase.auth.signInWithPassword({ email: e, password: p });
                if (error) {
                    const { data: nData, error: nError } = await _supabase.auth.signUp({ email: e, password: p });
                    if (nError) return Utils.toast(nError.message);
                    await _supabase.from('profiles').upsert({ id: nData.user.id, email: e, username: e.split('@')[0] });
                    this.initSession(nData.user);
                } else {
                    this.initSession(data.user);
                }
            },
            initSession(user) {
                currentUser = user;
                _supabase.from('profiles').select('*').eq('id', user.id).single().then(({data}) => {
                    if(data) {
                        document.getElementById('p-avatar').src = data.avatar_url || `https://api.dicebear.com/7.x/pixel-art/svg?seed=${user.id}`;
                        document.getElementById('best-score').innerText = data.high_score || 0;
                    }
                    gsap.to("#auth-overlay", { opacity: 0, duration: 1, onComplete: () => {
                        document.getElementById('auth-overlay').style.display = 'none';
                        Heart3D.init();
                    }});
                });
            },
            logout() { _supabase.auth.signOut(); window.location.reload(); }
        };

        const SnakeGame = {
            canvas: document.getElementById('snake-canvas'), ctx: null,
            box: 20, snake: [], food: null, dir: 'RIGHT', active: false, score: 0, loop: null,
            start() {
                this.ctx = this.canvas.getContext('2d');
                const s = this.canvas.parentElement.clientWidth - 50;
                this.canvas.width = s; this.canvas.height = s;
                this.box = s / 20; this.active = true; this.score = 0;
                this.snake = [{x: 10 * this.box, y: 10 * this.box}];
                this.spawnFood();
                if(this.loop) clearInterval(this.loop);
                this.loop = setInterval(() => this.update(), 120);
            },
            stop() { this.active = false; clearInterval(this.loop); },
            spawnFood() { this.food = { x: Math.floor(Math.random()*19)*this.box, y: Math.floor(Math.random()*19)*this.box }; },
            setDir(d) { this.dir = d; if(navigator.vibrate) navigator.vibrate(15); },
            update() {
                if(!this.active) return;
                let h = {...this.snake[0]};
                if(this.dir==='UP') h.y -= this.box; if(this.dir==='DOWN') h.y += this.box;
                if(this.dir==='LEFT') h.x -= this.box; if(this.dir==='RIGHT') h.x += this.box;
                if(h.x<0 || h.x>=this.canvas.width || h.y<0 || h.y>=this.canvas.height || this.snake.some(s=>s.x===h.x && s.y===h.y)) {
                    this.stop(); Utils.toast("NEURAL CRASH!"); return;
                }
                if(h.x === this.food.x && h.y === this.food.y) {
                    this.score++; this.spawnFood(); document.getElementById('score').innerText = this.score;
                    if(navigator.vibrate) navigator.vibrate(40);
                } else { this.snake.pop(); }
                this.snake.unshift(h);
                this.draw();
            },
            draw() {
                this.ctx.fillStyle = "#000"; this.ctx.fillRect(0,0,this.canvas.width, this.canvas.height);
                this.snake.forEach((p, i) => {
                    this.ctx.fillStyle = i === 0 ? "#ccff00" : "rgba(204,255,0,0.15)";
                    this.ctx.beginPath(); this.ctx.roundRect(p.x, p.y, this.box-1, this.box-1, 5); this.ctx.fill();
                });
                this.ctx.fillStyle = "#fff"; this.ctx.shadowBlur = 10; this.ctx.shadowColor = "#fff";
                this.ctx.fillRect(this.food.x+4, this.food.y+4, this.box-8, this.box-8);
                this.ctx.shadowBlur = 0;
            }
        };

        const Router = {
            go(id) {
                document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
                document.getElementById(`scene-${id}`).classList.add('active');
                document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.target === id));
                if(id !== 'game') SnakeGame.stop();
            }
        };

        const Heart3D = {
            scene: null, cam: null, rend: null, pts: null,
            init() {
                const c = document.getElementById('home-heart');
                this.scene = new THREE.Scene();
                this.cam = new THREE.PerspectiveCamera(75, c.clientWidth/c.clientHeight, 0.1, 1000);
                this.rend = new THREE.WebGLRenderer({alpha:true, antialias:true});
                this.rend.setSize(c.clientWidth, c.clientHeight);
                c.appendChild(this.rend.domElement);
                const v = []; for(let i=0; i<1800; i++) {
                    const t = Math.random() * 6.28;
                    v.push(16*Math.pow(Math.sin(t),3)*0.4, (13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))*0.4, (Math.random()-0.5)*3);
                }
                const geo = new THREE.BufferGeometry(); geo.setAttribute('position', new THREE.Float32BufferAttribute(v, 3));
                this.pts = new THREE.Points(geo, new THREE.PointsMaterial({color:0xccff00, size:0.08}));
                this.scene.add(this.pts); this.cam.position.z = 20;
                this.animate();
            },
            animate() {
                requestAnimationFrame(() => this.animate());
                if(this.pts) this.pts.rotation.y += 0.012;
                this.rend.render(this.scene, this.cam);
            }
        };

        const Utils = {
            toast: (m) => {
                const t = document.getElementById('toast'); t.innerText = m;
                t.classList.add('active'); setTimeout(() => t.classList.remove('active'), 3000);
            }
        };
    </script>
</body>
</html>
